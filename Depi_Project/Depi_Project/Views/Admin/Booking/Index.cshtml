@model List<Depi_Project.Controllers.Admin.BookingController.BookingListItem>

@{
    ViewData["Title"] = "Bookings (Admin)";
    var rooms = ViewBag.Rooms as List<Depi_Project.Models.Room> ?? new List<Depi_Project.Models.Room>();
    var paymentStatuses = ViewBag.PaymentStatuses as List<string> ?? new List<string>();
    var selectedRoomId = ViewBag.RoomId as int?;
    var selectedPayment = ViewBag.PaymentStatus as string ?? "";
    var selectedStatus = ViewBag.Status as string ?? "";
}

<style>
    /* Page background similar to other pages */
    body {
        background: #0f172a;
        color: #e6eef8;
        font-family: "Inter", "Segoe UI", Roboto, Arial, sans-serif;
    }

    .admin-container {
        max-width: 1150px;
        margin: 28px auto;
        padding: 0 16px;
    }

    h2.page-title {
        font-size: 1.7rem;
        font-weight: 900;
        color: #ffffff;
        margin-bottom: 18px;
    }

    .filter-card {
        background: rgba(255,255,255,0.04);
        padding: 18px;
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.45);
        border: 1px solid rgba(255,255,255,0.04);
        margin-bottom: 20px;
        color: #e6eef8;
    }

    .filter-card .form-label {
        color: #cbd5e1;
        font-weight: 600;
    }

    .filter-card .form-control,
    .filter-card .form-select,
    .filter-card input[type="date"],
    .filter-card input[type="text"] {
        border-radius: 10px;
        background: #fff;
        color: #0b1220;
    }

    .filter-row {
        gap: 10px;
    }

    .admin-table {
        background: rgba(255,255,255,0.03);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(2,6,23,0.6);
        border: 1px solid rgba(255,255,255,0.04);
    }

    table.bookings-table {
        margin-bottom: 0;
        color: #e6eef8;
        border-collapse: separate;
        border-spacing: 0;
        width: 100%;
    }

    table.bookings-table thead th {
        background: rgba(15,23,42,0.95);
        color: #fff;
        border-bottom: 1px solid rgba(255,255,255,0.04);
        padding: 12px 10px;
    }

    table.bookings-table tbody tr {
        background: rgba(255,255,255,0.01);
        transition: background-color .12s ease;
    }

    table.bookings-table tbody tr:nth-child(odd) {
        background: rgba(255,255,255,0.03);
    }

    table.bookings-table tbody tr:hover {
        background: rgba(255,255,255,0.12);
    }

    table.bookings-table td,
    table.bookings-table th {
        vertical-align: middle;
        padding: 12px 10px;
        color: #ffffff !important;
    }

    .text-muted.small {
        color: rgba(230,238,248,0.75) !important;
    }

    /* badges */
    .badge-paid { background: #28a745; color: #fff; }
    .badge-notpaid { background: #dc3545; color: #fff; }
    .badge-approved { background: #198754; color: #fff; }
    .badge-pending { background: #ffc107; color: #000; }
    .badge-canceled { background: #dc3545; color: #fff; }

    /* actions */
    .btn-small {
        padding: 6px 8px;
        font-size: 0.82rem;
        border-radius: 8px;
        min-width: 66px;
    }

    .btn-outline-primary { color: #0f172a; background: #fff; border-color: rgba(255,255,255,0.06); }
    .btn-outline-warning { color: #0f172a; background: #fff3cd; border-color: rgba(255,255,255,0.06); }
    .btn-outline-danger { color: #fff; background: transparent; border-color: rgba(255,255,255,0.06); }

    /* responsive tweaks */
    @@media (max-width: 900px) {
        .filter-card .col-md-3, .filter-card .col-md-2, .filter-card .col-md-1 { flex: 0 0 100%; max-width: 100%; }
        .filter-card .row { margin-bottom: 6px; }
        table.bookings-table thead { display: none; }
        table.bookings-table tbody tr { display: block; margin-bottom: 12px; border-radius: 10px; padding: 10px; background: rgba(255,255,255,0.02); }
        table.bookings-table tbody td { display: flex; justify-content: space-between; padding: 6px 8px; }
    }
</style>

<div class="admin-container">

    <h2 class="page-title">Bookings (Admin)</h2>

    <!-- FILTERS -->
    <div class="filter-card">
        <form method="get">
            <div class="row filter-row g-2">
                <div class="col-md-4">
                    <label class="form-label">Search (Email / Phone)</label>
                    <input name="search" class="form-control" placeholder="Search by email or phone..." value="@ViewBag.Search" />
                </div>

                <div class="col-md-2">
                    <label class="form-label">From</label>
                    <input name="from" type="date" class="form-control" value="@ViewBag.From" />
                </div>

                <div class="col-md-2">
                    <label class="form-label">To</label>
                    <input name="to" type="date" class="form-control" value="@ViewBag.To" />
                </div>

                <div class="col-md-2">
                    <label class="form-label">Room</label>
                    <select name="roomId" class="form-select">
                        <option value="">All</option>
                        @foreach (var r in rooms)
                        {
                            <option value="@r.RoomId" @@(selectedRoomId.HasValue && selectedRoomId.Value == r.RoomId ? "selected" : "")>
                                Room @r.RoomNum (@r.RoomType?.RoomTypeName)
                            </option>
                        }
                    </select>
                </div>

                <div class="col-md-2">
                    <label class="form-label">Payment</label>
                    <select name="paymentStatus" class="form-select">
                        <option value="">All</option>
                        @foreach (var ps in paymentStatuses)
                        {
                            <option value="@ps" @@(string.Equals(ps, selectedPayment, StringComparison.OrdinalIgnoreCase) ? "selected" : "")>@ps</option>
                        }
                    </select>
                </div>

                <!-- NEW: STATUS FILTER -->
                <div class="col-md-2">
                    <label class="form-label">Status</label>
                    <select name="status" class="form-select">
                        <option value="">All</option>
                        <option value="Pending" @@(string.Equals(selectedStatus, "Pending", StringComparison.OrdinalIgnoreCase) ? "selected" : "")>Pending</option>
                        <option value="Approved" @@(string.Equals(selectedStatus, "Approved", StringComparison.OrdinalIgnoreCase) ? "selected" : "")>Approved</option>
                        <option value="Canceled" @@(string.Equals(selectedStatus, "Canceled", StringComparison.OrdinalIgnoreCase) ? "selected" : "")>Canceled</option>
                    </select>
                </div>

                <div class="col-12 col-md-2 d-flex align-items-end">
                    <button class="btn btn-primary w-100">Filter</button>
                </div>
            </div>
        </form>
    </div>

    <!-- BOOKINGS TABLE -->
    <div class="admin-table">
        <table class="table bookings-table table-hover align-middle text-center">
            <thead>
                <tr>
                    <th style="width:60px;">#</th>
                    <th>Room</th>
                    <th>Customer</th>
                    <th>Check-In</th>
                    <th>Check-Out</th>
                    <th>Total</th>
                    <th>Payment</th>
                    <th>Status</th>
                    <th style="width: 180px;">Actions</th>
                </tr>
            </thead>

            <tbody>
                @foreach (var item in Model)
                {
                    var b = item.Booking;
                    var p = item.Profile;

                    <tr>
                        <td class="text-muted small">@b.BookingId</td>

                        <td class="text-start">
                            @if (b.Room != null)
                            {
                                <div style="font-weight:700; color:#fff;">Room @b.Room.RoomNum</div>
                                <div class="text-muted small">@b.Room.RoomType?.RoomTypeName</div>
                            }
                            else
                            {
                                <div style="color:#fff;">Room @b.RoomId</div>
                            }
                        </td>

                        <td class="text-start">
                            <div style="color:#fff;">@item.Email</div>
                            @if (p != null)
                            {
                                <div class="text-muted small">@p.FirstName @p.LastName</div>
                                <div class="text-muted small">@p.Phone</div>
                            }
                        </td>

                        <td>@b.CheckTime.ToString("yyyy-MM-dd")</td>
                        <td>@b.CheckOutTime.ToString("yyyy-MM-dd")</td>

                        <td>@b.TotalPrice.ToString("F2")</td>

                        <td>
                            @if (string.Equals(b.PaymentStatus, "Paid", StringComparison.OrdinalIgnoreCase))
                            {
                                <span class="badge badge-paid">Paid</span>
                            }
                            else if (string.Equals(b.PaymentStatus, "Pending", StringComparison.OrdinalIgnoreCase))
                            {
                                <span class="badge badge-pending">Pending</span>
                            }
                            else
                            {
                                <span class="badge badge-notpaid">Not Paid</span>
                            }
                        </td>

                        <td>
                            @if (string.Equals(b.Status, "Approved", StringComparison.OrdinalIgnoreCase))
                            {
                                <span class="badge badge-approved">Approved</span>
                            }
                            else if (string.Equals(b.Status, "Pending", StringComparison.OrdinalIgnoreCase))
                            {
                                <span class="badge badge-pending">Pending</span>
                            }
                            else
                            {
                                <span class="badge badge-canceled">Canceled</span>
                            }
                        </td>

                        <td>
                            <div class="d-flex justify-content-center gap-2">
                                <a class="btn btn-outline-primary btn-small" href="/Admin/Booking/Details/@b.BookingId">Details</a>

                                <a class="btn btn-outline-warning btn-small" href="/Admin/Booking/EditPayment/@b.BookingId">Edit</a>

                                <form asp-controller="Booking" asp-action="Cancel" asp-route-id="@b.BookingId" method="post" style="display:inline-block; margin:0;">
                                    <button class="btn btn-outline-danger btn-small" type="submit" onclick="return confirm('Cancel this booking?');">Cancel</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

</div>
